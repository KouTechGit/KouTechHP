# KouTech 授業動画プレーヤーページ 仕様書

## ページ概要

`player.html` は，KouTech の授業動画を視聴するためのプレーヤーページです。YouTube動画の再生，講義資料（PDF）の表示，動画一覧の閲覧ができるインタラクティブなページです。

---

## URLパラメータ

このページは以下のURLパラメータを受け取ります：

| パラメータ名 | 説明 | 例 | 必須 |
|------------|------|-----|------|
| `subject` | 科目名 | `数Ⅰ`, `数Ⅱ`, `数A`など | はい |
| `unit` | 単元名 | `数と式`, `2次関数`など | はい |
| `video` | 動画番号 | `1`, `2`, `3`... | いいえ（デフォルト: 1） |

### URL例

```
player.html?subject=数Ⅰ&unit=数と式&video=1
```

---

## ページ構成

### 1. ヘッダー

- **ロゴ**: トップページ（`../index.html`）へのリンク
- **科目・単元名表示**: URLパラメータから取得した情報を動的に表示
  - 例: "数Ⅰ 数と式"
- **一覧に戻るボタン**: 動画一覧ページ（`index.html`）へのリンク

### 2. 左サイドバー（デスクトップ）/ ボトムシート（モバイル）

**機能**: 動画一覧の表示

- 動画のサムネイル画像
- 動画タイトル（MathJaxで数式レンダリング対応）
- 再生時間
- 動画番号
- クリックすると該当動画を再生

**データソース**: `course_data.json` から動的に取得

### 3. メインコンテンツ

**YouTube動画プレーヤー**:
- YouTube IFrame APIを使用
- 動画IDは `course_data.json` から取得
- レスポンシブ対応（画面サイズに応じて自動調整）

**モバイルアクションボタン**（モバイル版のみ表示）:
- 「動画一覧」ボタン: 左サイドバーをボトムシートとして開く
- 「講義資料」ボタン: 右サイドバーをボトムシートとして開く

**動画の概要説明**:
- `course_data.json` の `description` フィールドから取得
- MathJaxで数式がレンダリングされる場合あり
- HTML形式またはプレーンテキスト形式に対応

### 4. 右サイドバー（デスクトップ）/ ボトムシート（モバイル）

**機能**: 講義資料（PDF）の表示

- PDF.jsを使用してPDFをレンダリング
- モバイルではピンチズーム（2本指拡大縮小）に対応
- デスクトップではマウスホイール + Ctrl/Cmd で拡大縮小
- ドラッグ操作でPDFを移動可能

**データソース**: `course_data.json` の `material_file_id` からPDFパスを生成

---

## レスポンシブ対応

### デスクトップ版（画面幅 > 768px）

- **レイアウト**: 3カラム（左サイドバー + メインコンテンツ + 右サイドバー）
- **サイドバー**: 常に表示，折りたたみボタンで開閉可能
- **オーバーレイ**: ボトムシート表示時に背景を暗く表示

### モバイル版（画面幅 ≤ 768px）

- **レイアウト**: 1カラム（メインコンテンツのみ）
- **ボトムシート**: 動画コンテナの真下からスライドアップ
- **スワイプ操作**: 下方向へのスワイプで閉じる
- **画面外タップ**: 動画エリアなどをタップすると閉じる
- **スクロールロック**: ボトムシート表示中は背景スクロールを無効化

---

## 動作フロー

### ページ読み込み時

1. URLパラメータ（`subject`, `unit`, `video`）を取得
2. `course_data.json` を読み込み
3. 科目名・単元名に一致するデータを検索
4. 動画一覧を左サイドバーに表示
5. 指定された動画（またはデフォルトの動画）を再生
6. 動画の説明を表示
7. 講義資料（PDF）があれば表示

### 動画切り替え時

1. 動画一覧から動画をクリック
2. URLパラメータ（`video`）を更新（ページリロードなし）
3. YouTubeプレーヤーで新しい動画を再生
4. 動画の説明を更新
5. 講義資料を更新
6. モバイル版ではボトムシートを自動で閉じる（500ms後）

### モバイル版ボトムシート操作

**開く**:
- アクションボタンをタップ
- 動画コンテナの真下からスライドアップ
- 背景スクロールをロック

**閉じる**:
- 閉じるボタン（✕）をタップ
- 下方向へスワイプ（100px以上，または高速スワイプ）
- 画面外をタップ
- ESCキー（キーボードがある場合）

---

## データ構造

### course_data.json の構造

```json
{
  "subjects": [
    {
      "subject_name": "数Ⅰ",
      "units": [
        {
          "unit_name": "数と式",
          "videos": [
            {
              "video_number": 1,
              "title": "動画タイトル",
              "youtube_id": "動画ID",
              "duration": "10:30",
              "description": "動画の説明",
              "material_file_id": "数と式_Part1.pdf"
            }
          ]
        }
      ]
    }
  ]
}
```

---

## 技術スタック

### フロントエンドライブラリ

- **PDF.js**: PDFファイルの表示（バージョン 3.11.174）
- **MathJax**: LaTeX形式の数式レンダリング
- **YouTube IFrame API**: YouTube動画の埋め込み再生
- **Google Fonts**: フォント（Montserrat, Noto Sans JP）

### JavaScriptモジュール

1. **pdf-viewer.js**: PDFビューアコンポーネント
   - PDFのレンダリング
   - ズーム・パン操作
   - ピンチズーム（モバイル）

2. **player-ui.js**: UI制御コンポーネント
   - サイドバーの開閉（デスクトップ）
   - ボトムシートの表示・非表示（モバイル）
   - スワイプジェスチャー処理
   - レスポンシブ対応
   - テーマカラー設定

3. **player.js**: メインロジック
   - データ取得（`course_data.json`）
   - YouTube動画の再生制御
   - 動画一覧の表示
   - 動画説明の表示
   - PDFビューアの初期化

---

## 主要な機能仕様

### 動画再生

- YouTube IFrame APIを使用
- `playsinline: 1` でインライン再生（モバイルでも全画面にならない）
- `rel: 0` で関連動画の表示を制御

### PDF表示

**デスクトップ版**:
- マウスホイール + Ctrl/Cmd で拡大縮小
- ドラッグで移動
- キーボードショートカット（+/-キーで拡大縮小，Rキーでリセット）

**モバイル版**:
- ピンチズーム（2本指拡大縮小）
- ドラッグで移動
- タッチ操作最適化

### 数式表示

- MathJaxを使用してLaTeX形式の数式をレンダリング
- インライン数式: `$...$` または `\(...\)`
- ディスプレイ数式: `$$...$$` または `\[...\]`
- 動的に追加された要素にも自動レンダリング

### テーマカラー

科目ごとに異なるテーマカラーが自動適用されます：

- 数Ⅰ: 青系
- 数Ⅱ: 緑系
- 数Ⅲ: 紫系
- 数A: オレンジ系
- 数B: ピンク系
- 数C: 水色系

CSS変数（`--accent-primary`など）を動的に変更することで実現しています。

---

## ブラウザ対応

- モダンブラウザ対応（Chrome, Firefox, Safari, Edge）
- モバイルブラウザ対応（iOS Safari, Chrome for Android）
- タッチ操作対応
- レスポンシブデザイン対応

---

## パフォーマンス最適化

- MathJaxの非同期読み込み
- Google Fontsのプリコネクト
- 画像の遅延読み込み（`loading="lazy"`）
- PDFのレンダリング最適化（デバイスピクセル比考慮）

---

## アクセシビリティ

- ARIAラベル付きボタン
- キーボードショートカット対応（ESCキーでボトムシートを閉じる）
- セマンティックHTML（`<header>`, `<main>`, `<aside>` など）

